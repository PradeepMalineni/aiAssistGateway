# DevX Gateway MCP Starter

This repo is a working copy you can run locally to integrate **DevX docs routing** with an **MCP-like server**
that performs the API Gateway flow: **Analyze OAS → Decide Gateway → Synthesize Guardrails → Generate Bundle → Gate**.

## What’s inside
- `docs/` — sample docs (markdown)
- `index.csv` + `prompt.md` — generated by the indexer (also committed for convenience)
- `server/` — FastAPI MCP-style server exposing tools (`/tools/*`)
- `examples/` — sample OpenAPI
- `scripts/devx_indexer.py` — generates index & prompt from docs
- `.github/workflows/ci.yml` — regenerates index, runs a dry-run toolchain

## Quickstart
```bash
python -m venv .venv && source .venv/bin/activate
pip install -r requirements.txt

# (Optional) set OpenAI key to enable LLM augmentation
export OPENAI_API_KEY=sk-...

# 1) Regenerate index and prompt from /docs
python scripts/devx_indexer.py --repo-url https://github.com/example/devx-gateway-mcp --branch main --docs-dir docs --out-csv index.csv --out-prompt prompt.md --llm Y

# 2) Run the MCP server
uvicorn server.main:app --reload --port 8000

# 3) Call tools (examples):
# Discover OAS in examples
curl -s http://localhost:8000/tools/discover_oas -H "Content-Type: application/json" -d '{"workspaceRoot":"examples"}' | jq

# Full pipeline on sample OAS
curl -s http://localhost:8000/tools/run_gateway_assistant -H "Content-Type: application/json" -d '{"oasPath":"examples/apis/petstore/openapi.yaml","outDir":".out"}' | jq
```

> In your **DevX** agent: map an action topic `gateway-assistant` (from `prompt.md`) to call the server tool `run_gateway_assistant` with the OAS path resolved from `index.csv` or discovered from the workspace.

## Files to notice
- `server/main.py` – FastAPI app & tool routes
- `server/llm.py` – Optional OpenAI usage (JSON responses, retried)
- `server/logic/*.py` – analysis, decision, guardrails, builder, gate
- `server/templates/*` – Jinja for Apigee/DataPower
- `index.csv` & `prompt.md` – what DevX wants (auto-generated)

## Security & Governance
- AI suggestions are **catalog-constrained** and **never bypass gates**.
- OPA step here is a simple Python gate; wire real OPA in your pipeline.
- Keep secrets out of templates; use Vault references in real bundles.

# aiAssistGateway
